# @axmat/bsondb ğŸ—„ï¸

A simple but powerful NoSQL database with BSON files, encryption, and file storage capabilities. âš¡

âœ¨ **Features**

    ğŸ“ BSON File Storage: Efficient binary JSON storage

    ğŸ” Encryption: AES-256-GCM encryption for data security

    ğŸ“ File Storage: Store files directly in the database

    ğŸ“Š Indexing: Single and multi-field indexing with Redis support
    
    ğŸ”„ Mongoose-like API: Familiar interface for MongoDB users
        
    âš¡ Multi-threading: Worker thread support for better performance
    
    ğŸ  Localhost Only: Secure by default, only accessible from localhost
        
    âœ… Schema Validation: Data validation with custom schemas
        
    ğŸ£ Hooks: Pre and post hooks for data manipulation

ğŸš€ **Installation**
*As NPM Package*

```bash
npm install @axmat/bsondb
```


*Global Installation (for CLI)*

```bash
npm install -g @axmat/bsondb
```


ğŸ **Quick Start**
*Using as Module*

```javascript
const bsondb = require('@axmat/bsondb');

async function example() {
  // Connect to database (creates if doesn't exist)
  const db = await bsondb.connect('mydatabase', {
    dataPath: './data',
    encryptionKey: 'my-secret-key',
    redisUrl: 'redis://localhost:6379'
  });

  // Create collection
  const users = await db.createCollection('users');

  // Insert documents
  await users.insertOne({
    name: 'John Doe',
    email: 'john@example.com',
    age: 30
  });

  // Find documents
  const results = await users.find({ age: { $gte: 18 } });
  console.log(results);
}

example();

Using Models
javascript

const bsondb = require('@axmat/bsondb');

// Define schema
const userSchema = {
  name: { type: 'string', required: true },
  email: { type: 'string', required: true, match: /.+@.+\..+/ },
  age: { type: 'number', min: 0, max: 150 }
};

// Create model
const User = bsondb.model('User', userSchema);

async function modelExample() {
  const db = await bsondb.connect('mydatabase');
  const usersCollection = await db.createCollection('users');
  
  User.setCollection(usersCollection);

  // Add hooks
  User.pre('save', async (doc) => {
    doc.createdAt = new Date();
    return doc;
  });

  // Create document
  const user = await User.create({
    name: 'Jane Smith',
    email: 'jane@example.com',
    age: 25
  });

  // Find documents
  const users = await User.find({ age: { $gt: 20 } });
}

```

*Using CLI Server*
*Start server with custom options*

```bash
bsondb -port 6458 -thread 4 -data ./mydata -encryption-key my-key
```


**Default usage**

```bash
bsondb
```


ğŸ“š *API Reference*
ğŸ—ƒï¸ *Database Methods*

```methods bsondb
    connect(dbName, options) - Connect to database ğŸ”Œ
    disconnect(dbName) - Disconnect from database ğŸ”‹
    createCollection(name, options) - Create new collection ğŸ†•
    dropCollection(name) - Drop collection ğŸ—‘ï¸
    collection(name) - Get collection instance ğŸ“‚
    stats() - Get database statistics ğŸ“ˆ
```
ğŸ“„ *Collection Methods*

```methods bsondb
    insertOne(document) - Insert single document â•
    insertMany(documents) - Insert multiple documents ğŸš€
    find(query, options) - Find documents ğŸ”
    findOne(query) - Find single document ğŸ‘ï¸
    updateOne(query, update, options) - Update single document âœï¸
    updateMany(query, update) - Update multiple documents ğŸ“
    deleteOne(query) - Delete single document âŒ
    deleteMany(query) - Delete multiple documents ğŸ—‘ï¸
    count(query) - Count documents ğŸ”¢
    createIndex(fields, options) - Create index ğŸ“Š
    dropIndex(fields) - Drop index ğŸ“‰
```

ğŸ” *Query Operators*

```bsondb operators
    $eq - Equal âœ…
    $ne - Not equal âŒ
    $gt - Greater than â¬†ï¸
    $gte - Greater than or equal â¬†ï¸âœ…
    $lt - Less than â¬‡ï¸
    $lte - Less than or equal â¬‡ï¸âœ…
    $in - In array ğŸ“¥
    $nin - Not in array ğŸ“¤
    $regex - Regular expression ğŸ”¤
    $and - Logical AND ğŸ”—
    $or - Logical OR ğŸ”€
```
âœï¸ *Update Operators*

```bsondb operators
    $set - Set field values ğŸ¯
    $unset - Remove fields ğŸ—‘ï¸
    $inc - Increment field values â•
    $push - Push to array ğŸ“¥
```
ğŸ­ *Model Methods*

```bsondb model methods
    create(data) - Create document(s) ğŸ†•
    find(query, options) - Find documents ğŸ”
    findOne(query) - Find single document ğŸ‘ï¸
    findById(id) - Find by ID ğŸ†”
    updateOne(query, update, options) - Update document âœï¸
    updateMany(query, update) - Update multiple documents ğŸ“
    deleteOne(query) - Delete document âŒ
    deleteMany(query) - Delete multiple documents ğŸ—‘ï¸
    count(query) - Count documents ğŸ”¢
    pre(hook, fn) - Add pre-hook âª
    post(hook, fn) - Add post-hook â©
```
âœ… *Schema Validation*

*Schemas support the following validators:*

```Model validate Schema
    type - Data type (string, number, boolean, etc.) ğŸ”¤
    required - Field is required â­
    min - Minimum value (numbers) ğŸ“
    max - Maximum value (numbers) ğŸ“
    enum - Allowed values ğŸ¯
    match - Regular expression pattern ğŸ”
    validate - Custom validation function âš™ï¸
```
ğŸ“ *File Storage*

```javascript

const db = await bsondb.connect('filesdb');
await db.fileStorage.init();

// Store file
const fileId = await db.fileStorage.storeFile('./path/to/file.txt', {
  filename: 'document.txt',
  contentType: 'text/plain'
});

// Retrieve file
const fileStream = await db.fileStorage.getFileStream(fileId);
const fileData = await fileStream.read();

// Delete file
await db.fileStorage.deleteFile(fileId);

ğŸ“Š Indexing
javascript

const collection = await db.createCollection('users');

// Single field index
await collection.createIndex('email');

// Compound index
await collection.createIndex(['name', 'age']);

// Unique index
await collection.createIndex('email', { unique: true });

// Drop index
await collection.dropIndex('email');

```

âŒ¨ï¸ *CLI Options*

```Info
    -p, --port <number> - Port number (default: 6458) ğŸšª
    -t, --thread <number> - Number of worker threads (default: CPU cores) âš¡
    -h, --host <string> - Host address (default: localhost) ğŸŒ
    -d, --data <path> - Data directory path (default: ./data) ğŸ“
    -r, --redis <string> - Redis connection string (default: redis://localhost:6379) ğŸ›‘
    -e, --encryption-key <string> - Encryption key (default: default-encryption-key) ğŸ”‘
```
ğŸŒ *REST API*
```Info
When running as server, bsondb provides REST API:
    POST /api/db/:dbName/connect - Connect to database ğŸ”Œ
    POST /api/db/:dbName/collection/:collectionName - Create collection ğŸ†•
    POST /api/db/:dbName/collection/:collectionName/insert - Insert documents â•
    GET /api/db/:dbName/collection/:collectionName/find - Find documents ğŸ”
    PUT /api/db/:dbName/collection/:collectionName/update - Update documents âœï¸
    DELETE /api/db/:dbName/collection/:collectionName/delete - Delete documents âŒ
```
ğŸ”’ *Security*

    ğŸ” Data is encrypted using AES-256-GCM

    ğŸ  Server only binds to localhost by default

    ğŸ“Š File-based and Redis-based indexing options

    âœ… Schema validation prevents invalid data

ğŸš€ *Performance Tips*

    ğŸ“Š Use indexes for frequently queried fields
    
    âš¡ Use multi-threading for heavy workloads
        
    ğŸ’¾ Store large files using file storage API
    
    ğŸ›‘ Use Redis for better index performance

ğŸ“„ **License - MIT**
â“ Support


This README provides comprehensive documentation for using bsondb in various scenarios. The database is designed to be simple yet powerful, offering features similar to MongoDB with the convenience of file-based storage and built-in encryption. ğŸ‰
